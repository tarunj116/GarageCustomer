/*!
 * MIT License
 * 
 * Copyright (c) 2021 Yoav Niran
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rpldy=t():e.rpldy=t()}(window,(function(){return function(e){function t(t){for(var r,s,i=t[0],c=t[1],d=t[2],u=0,p=[];u<i.length;u++)s=i[u],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&p.push(o[s][0]),o[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={core:0},a=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonprpldy=window.webpackJsonprpldy||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var l=c;return a.push([0,"polyfills"]),n()}({0:function(e,t,n){n("Xsbf"),n("mHo/"),n("GjXi"),e.exports=n("SXZu")},DVTP:function(e,t){e.exports=function(){return!0}},GjXi:function(e,t,n){"use strict";n.r(t),n.d(t,"send",(function(){return g})),n.d(t,"getXhrSend",(function(){return p})),n.d(t,"XHR_SENDER_TYPE",(function(){return o})),n.d(t,"MissingUrlError",(function(){return a}));var r=n("mHo/");const o="rpldy-sender";class a extends Error{constructor(e){super(e+" didn't receive upload URL"),this.name="MissingUrlError"}}const s=(e,t,...n)=>{e.set?e.set(t,...n):(e.delete&&e.delete(t),e.append(t,...n))};var i=(e,t)=>{const n=new FormData;return t.params&&Object.entries(t.params).forEach(([e,t])=>s(n,e,t)),((e,t,n)=>{const o=1===t.length;t.forEach((t,a)=>{const i=o?n.paramName:Object(r.isFunction)(n.formatGroupParamName)?n.formatGroupParamName(a,n.paramName):`${n.paramName}[${a}]`;t.file?s(e,i,t.file,t.file.name):t.url&&s(e,i,t.url)})})(n,e,t),n};const c=[200,201,202,203,204],d=(e,t,n,o,a)=>{let s;const c=null!=a&&a.getRequestData?a.getRequestData(e,n):((e,t)=>{let n;if(t.sendWithFormData)r.logger.debugLog(`uploady.sender: sending ${e.length} item(s) as form data`),n=i(e,t);else{if(e.length>1)throw new Error("XHR Sender - Request without form data can only contain 1 item. received "+e.length);const t=e[0];r.logger.debugLog(`uploady.sender: sending item ${t.id} as request body`),n=t.file||t.url}return n})(e,n),d=(a=t,i=c,d)=>{d=Object(r.merge)({...Object(r.pick)(n,["method","headers","withCredentials"]),preSend:t=>{t.upload.onprogress=t=>{t.lengthComputable&&o&&o(t,e.slice())}}},d);const l=Object(r.request)(a,i,d);return s=l.xhr,l},l=null!=a&&a.preRequestHandler?a.preRequestHandler(d,e,t,n,o,a):d();return{url:t,count:e.length,pXhr:l,getXhr:()=>s,aborted:!1}},l=(e,t,n)=>{let r=e;const o=null==t?void 0:t["content-type"];if(n.forceJsonResponse||null!=o&&o.includes("json"))try{r=JSON.parse(e)}catch{}return r},u=(e,t)=>e.pXhr.then(e=>{var n,o;let a,s,i;r.logger.debugLog("uploady.sender: received upload response ",e),a=~c.indexOf(e.status)?r.FILE_STATES.FINISHED:r.FILE_STATES.ERROR,i=e.status;const d=Object(r.parseResponseHeaders)(e);return s={data:null!==(n=null===(o=t.formatServerResponse)||void 0===o?void 0:o.call(t,e.response,i,d))&&void 0!==n?n:l(e.response,d,t),headers:d},{status:i,state:a,response:s}}).catch(t=>{let n,o;return e.aborted?(n=r.FILE_STATES.ABORTED,o="aborted"):(r.logger.debugLog("uploady.sender: upload failed: ",t),n=r.FILE_STATES.ERROR,o=t),{error:!0,state:n,response:o,status:0}});var p=e=>(t,n,s,i)=>{if(!n)throw new a(o);r.logger.debugLog("uploady.sender: sending file: ",{items:t,url:n,options:s});const c=d(t,n,s,i,e);return{request:u(c,s),abort:()=>(e=>{let t=!1;const{aborted:n,getXhr:o}=e,a=o();return!n&&a&&a.readyState&&4!==a.readyState&&(r.logger.debugLog(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),a.abort(),e.aborted=!0,t=!0),t})(c),senderType:o}};const g=p();t.default=g},SXZu:function(e,t,n){"use strict";n.r(t),n.d(t,"UPLOADER_EVENTS",(function(){return f})),n.d(t,"DEFAULT_OPTIONS",(function(){return X})),n.d(t,"composeEnhancers",(function(){return te})),n.d(t,"createUploader",(function(){return ee})),n.d(t,"send",(function(){return k.send})),n.d(t,"getXhrSend",(function(){return k.getXhrSend})),n.d(t,"XHR_SENDER_TYPE",(function(){return k.XHR_SENDER_TYPE})),n.d(t,"MissingUrlError",(function(){return k.MissingUrlError}));var r=n("Xsbf"),o=n("mHo/");const a=Symbol.for("__rpldy-sstt-proxy__"),s=Symbol.for("__rpldy-sstt-state__"),i=e=>!Object(o.isProduction)()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(a),c=e=>Array.isArray(e)||Object(o.isPlainObject)(e)&&!(e=>Object(o.hasWindow)()&&e instanceof File||e.name&&e.size&&e.uri)(e),d=Object(o.getMerge)({withSymbols:!0,predicate:e=>e!==a&&e!==s}),l=e=>!!Object(o.isProduction)()||e[s].isUpdateable,u=(e,t)=>{Object(o.isProduction)()||(e[s].isUpdateable=t)},p=(e,t)=>{let n;return c(e)&&(i(e)||(e[a]=!0,n=new Proxy(e,t)),Object.keys(e).forEach(n=>{e[n]=p(e[n],t)})),n||e},g=e=>i(e)?Object(o.clone)(e,d):e;const f=Object(o.devFreeze)({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),h=Object(o.devFreeze)({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),E=[o.FILE_STATES.FINISHED,o.FILE_STATES.ERROR,o.FILE_STATES.CANCELLED,o.FILE_STATES.ABORTED],b=[o.BATCH_STATES.ADDED,o.BATCH_STATES.PROCESSING,o.BATCH_STATES.UPLOADING],S=[o.BATCH_STATES.ABORTED,o.BATCH_STATES.CANCELLED,o.BATCH_STATES.FINISHED],m=(e,t)=>e.batches[t].batch,T=(e,t,n)=>e.getState().items[t].batchId===n,A=(e,t)=>{const n=e.getState(),r=n.items[t];return n.batches[r.batchId]},O=(e,t)=>A(e,t).batch,v=(e,t)=>{const n=((e,t)=>m(e.getState(),t))(e,t);e.updateState(e=>{n.items.forEach(({id:t})=>{delete e.items[t];const n=e.itemQueue.indexOf(t);~n&&e.itemQueue.splice(n,1)})})},y=(e,t)=>{e.updateState(e=>{delete e.batches[t]})},_=(e,t,n)=>{const r=e.getState(),o=m(r,t),a=r.items,s={...g(o),items:o.items.map(({id:e})=>g(a[e]))};e.trigger(n,s)},I=(e,t)=>{const n=O(e,t);return b.includes(n.state)},R=e=>S.includes(e.state),P={[o.FILE_STATES.PENDING]:null,[o.FILE_STATES.ADDED]:f.ITEM_START,[o.FILE_STATES.FINISHED]:f.ITEM_FINISH,[o.FILE_STATES.ERROR]:f.ITEM_ERROR,[o.FILE_STATES.CANCELLED]:f.ITEM_CANCEL,[o.FILE_STATES.ABORTED]:f.ITEM_ABORT,[o.FILE_STATES.UPLOADING]:f.ITEM_PROGRESS},C=e=>!!~E.indexOf(e.state);var L=(e,t,n)=>(t.forEach(t=>{const n=e.getState(),{id:r,info:a}=t;if(o.logger.debugLog("uploader.processor.queue: request finished for item - ",{id:r,info:a}),n.items[r]){e.updateState(e=>{const t=e.items[r];t.state=a.state,t.uploadResponse=a.response,t.uploadStatus=a.status,C(t)&&delete e.aborts[r]});const t=e.getState().items[r];a.state===o.FILE_STATES.FINISHED&&t.completed<100&&e.handleItemProgress(t,100,t.file?t.file.size:0),P[t.state]&&e.trigger(P[t.state],t),C(t)&&(((e,t)=>{e.updateState(e=>{e.batches[t].finishedCounter+=1})})(e,t.batchId),e.trigger(f.ITEM_FINALIZE,t))}const s=n.itemQueue.indexOf(r);~s&&e.updateState(e=>{e.itemQueue.splice(s,1);const t=e.activeIds.indexOf(r);~t&&e.activeIds.splice(t,1)})}),(e=>{const t=e.getState();Object.keys(t.batches).forEach(n=>{const{batch:r,finishedCounter:a}=t.batches[n],{orgItemCount:s}=r,i=R(r);s===a&&(e.updateState(e=>{const t=m(e,n);t.state=i?t.state:o.BATCH_STATES.FINISHED,e.currentBatch===n&&(e.currentBatch=null)}),o.logger.debugLog("uploady.uploader.batchHelpers: cleaning up batch: "+r.id),i||_(e,n,f.BATCH_FINISH),v(e,n),y(e,n))})})(e),n(e));const D=Object(o.getMerge)({undefinedOverwrites:!0}),w=(e,t)=>{const n=t.map(e=>e.id);return e.updateState(e=>{e.activeIds=e.activeIds.concat(n)}),((e,t,n)=>Object(o.triggerUpdater)(e.trigger,f.REQUEST_PRE_SEND,{items:t,options:n}).then(e=>{if(e){if(o.logger.debugLog("uploader.queue: REQUEST_PRE_SEND event returned updated items/options",e),e.items){if(e.items.length!==t.length||!Object(o.isSamePropInArrays)(e.items,t,["id","batchId","recycled"]))throw new Error("REQUEST_PRE_SEND event handlers must return same items with same ids");t=e.items}e.options&&(n=D({},n,e.options))}return{items:t,options:n,cancelled:!1===e}}))(e,t,e.getState().batches[t[0].batchId].batchOptions).then(n=>{if(!n.cancelled){e.updateState(e=>{n.items.forEach(t=>{e.items[t.id]=t}),e.batches[t[0].batchId].batchOptions=n.options});const r=e.getState();n.items=n.items.map(e=>r.items[e.id]),n.options=r.batches[t[0].batchId].batchOptions}return n})},j=(e,t,n)=>{const{items:r,options:a}=t,s=e.getState().batches[r[0].batchId].batch;let i;try{i=e.sender.send(r,s,a)}catch(e){o.logger.debugLog("uploader.queue: sender failed with unexpected error",e),i={request:Promise.resolve({status:0,state:o.FILE_STATES.ERROR,response:e.message}),abort:()=>!1,senderType:"exception-handler"}}const{request:c}=i;return((e,t,n)=>{e.updateState(e=>{t.forEach(t=>{e.items[t.id].state=o.FILE_STATES.UPLOADING,e.aborts[t.id]=n.abort})})})(e,r,i),c.then(t=>{const o=r.map(e=>({id:e.id,info:t}));L(e,o,n)})};var B=(e,t,n)=>{const r=e.getState();let a=Object.values(r.items);return a=a.filter(e=>!!~t.indexOf(e.id)),Promise.all(a.map(t=>e.runCancellable(f.ITEM_START,t))).then(t=>({allowedItems:t.map((t,n)=>t?null:((e,t)=>t.getState().items[e])(a[n].id,e)).filter(Boolean),cancelledResults:t})).then(({allowedItems:r,cancelledResults:s})=>(r.length?w(e,r).then():Promise.resolve()).then(r=>{let i;return r&&(r.cancelled?s=t.map(()=>!0):j(e,r,n)),((e,t,n,r)=>{const a=n.map((e,n)=>e?t[n].id:null).filter(Boolean);if(a.length){const t=a.map(e=>({id:e,info:{status:0,state:o.FILE_STATES.CANCELLED,response:"cancel"}}));L(e,t,r)}return!!a.length})(e,a,s,n)||(i=n(e)),i}))};const N=(e,t)=>!!~e.getState().activeIds.flat().indexOf(t),F=e=>{const t=e.getState().itemQueue,n=(e=>{const t=e.getState(),n=t.itemQueue,r=t.items;let a=0,s=n[a];for(;s&&(N(e,s)||!I(e,s)||r[s].state!==o.FILE_STATES.ADDED);)a+=1,s=n[a];return s?a:-1})(e);let r,a=t[n];if(a){const o=A(e,a),s=o.batch.id,i=o.batchOptions.maxGroupSize||0;if(o.batchOptions.grouped&&i>1){r=[];let o=!0;for(;r.length<i&&o;)r.push(a),a=t[n+r.length],o=a&&T(e,a,s)}else r=[a]}return r},H=e=>{const t=F(e);let n=Promise.resolve();if(t){const r=e.getCurrentActiveCount(),{concurrent:a=0,maxConcurrent:s=0}=e.getOptions();if(!r||a&&r<s){o.logger.debugLog("uploader.processor: Processing next upload - ",{ids:t,state:e.getState(),currentCount:r});let a=!1,s=Promise.resolve(!1);((e,t)=>{const n=O(e,t);return e.getState().currentBatch!==n.id})(e,t[0])&&(s=((e,t)=>{const n=O(e,t);return e.runCancellable(f.BATCH_START,n).then(t=>(t||e.updateState(e=>{e.currentBatch=n.id}),!t))})(e,t[0]).then(n=>(a=!n,a&&(((e,t)=>{const n=O(e,t),r=n.id;o.logger.debugLog("uploady.uploader.batchHelpers: cancelling batch: ",{batch:n}),e.updateState(e=>{m(e,r).state=o.BATCH_STATES.CANCELLED}),_(e,r,f.BATCH_CANCEL),v(e,r),y(e,r)})(e,t[0]),H(e)),a))),n=s.then(n=>{n||B(e,t,H)})}}return n};var x=H;const G=(e,t,n)=>(o.logger.debugLog(`uploader.queue: aborting ${t.state} item  - `,t),L(e,[{id:t.id,info:{status:0,state:o.FILE_STATES.ABORTED,response:"aborted"}}],n),!0),M={[o.FILE_STATES.UPLOADING]:(e,t)=>(o.logger.debugLog("uploader.queue: aborting uploading item  - ",t),e.getState().aborts[t.id]()),[o.FILE_STATES.ADDED]:G,[o.FILE_STATES.PENDING]:G},U=(e,t,n)=>{const r=e.getState().items[t],o=null==r?void 0:r.state;return!!M[o]&&M[o](e,r,n)};var q=(e,t,n,r,c)=>{const{state:d,update:E}=(e=>{const t={set:(e,r,o)=>(l(n)&&(e[r]=p(o,t)),!0),get:(e,t)=>t===a?g(e):e[t],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(e,t)=>(l(n)&&delete e[t],!0)};Object(o.isProduction)()||i(e)||Object.defineProperty(e,s,{value:{isUpdateable:!1},configurable:!0});const n=Object(o.isProduction)()?e:p(e,t);return{state:n,update:e=>{if(!Object(o.isProduction)()&&l(n))throw new Error("Can't call update on State already being updated!");try{u(n,!0),e(n)}finally{u(n,!1)}return n},unwrap:e=>e?g(e):i(n)?g(n):n}})({itemQueue:[],currentBatch:null,batches:{},items:{},activeIds:[],aborts:{}}),b=()=>d,S=e=>{E(e)},T=e=>{if(d.items[e.id]&&!e.recycled)throw new Error(`Uploader queue conflict - item ${e.id} already exists`);e.recycled&&((e,t)=>{const{previousBatch:n}=t;if(t.recycled&&n&&e.getState().batches[n]){const{id:r}=O(e,t.id);r===n&&e.updateState(e=>{const n=m(e,r),o=n.items.findIndex(({id:e})=>e===t.id);~o&&n.items.splice(o,1)})}})(I,e),S(t=>{t.items[e.id]=e,t.itemQueue.push(e.id)})},A=(e,n,r)=>{d.items[e.id]&&(S(t=>{const o=t.items[e.id];o.loaded=r,o.completed=n}),t(f.ITEM_PROGRESS,b().items[e.id]))};r.on(h.ITEM_PROGRESS,A),r.on(h.BATCH_PROGRESS,e=>{var n;const r=null===(n=d.batches[e.id])||void 0===n?void 0:n.batch.items;if(r){const[n,o]=r.reduce((e,t)=>(e[0]+=t.completed,e[1]+=t.loaded,e),[0,0]);S(t=>{const a=t.batches[e.id].batch;a.completed=n/r.length,a.loaded=o}),t(f.BATCH_PROGRESS,d.batches[e.id].batch)}});const I={uploaderId:c,getOptions:()=>e,getCurrentActiveCount:()=>d.activeIds.length,getState:b,updateState:S,trigger:t,runCancellable:(e,...t)=>{if(!Object(o.isFunction)(n))throw new Error("cancellable is of wrong type");return n(e,...t)},sender:r,handleItemProgress:A};return Object(o.hasWindow)()&&o.logger.isDebugOn()&&(window[`__rpldy_${c}_queue_state`]=I),{updateState:S,getState:I.getState,runCancellable:I.runCancellable,uploadBatch:(e,t)=>{t&&S(n=>{n.batches[e.id].batchOptions=t}),x(I)},addBatch:(e,t)=>(S(n=>{n.batches[e.id]={batch:e,batchOptions:t,finishedCounter:0}}),e.items.forEach(T),m(d,e.id)),abortItem:e=>((e,t,n)=>U(e,t,n))(I,e,x),abortBatch:e=>{((e,t,n)=>{const r=e.getState().batches[t],a=null==r?void 0:r.batch;a&&!R(a)&&(e.updateState(e=>{m(e,t).state=o.BATCH_STATES.ABORTED}),_(e,t,f.BATCH_ABORT),a.items.forEach(t=>U(e,t.id,n)))})(I,e,x)},abortAll:()=>{((e,t)=>{const n=e.getState().items;Object.keys(n).forEach(n=>U(e,n,t)),e.trigger(f.ALL_ABORT)})(I,x)},clearPendingBatches:()=>{(e=>{const t=e.getState().batches;Object.keys(t).filter(e=>t[e].batch.state===o.BATCH_STATES.PENDING).forEach(t=>{v(e,t),y(e,t)})})(I)},uploadPendingBatches:e=>{((e,t)=>{e.updateState(e=>{Object.keys(e.batches).forEach(n=>{const r=e.batches[n],{batch:a,batchOptions:s}=r;a.state===o.BATCH_STATES.PENDING&&(a.items.forEach(e=>{e.state=o.FILE_STATES.ADDED}),a.state=o.BATCH_STATES.ADDED,r.batchOptions=Object(o.merge)({},s,t))})})})(I,e),x(I)}}},k=n("GjXi");const $=()=>!0,X=Object(o.devFreeze)({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:$,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0}),Q=(e,t,n,r)=>{((e,t,n,r)=>{e.forEach(e=>{o.logger.debugLog(`uploady.uploader.processor: file: ${e.id} progress event: loaded(${n}) - completed(${t})`),r(h.ITEM_PROGRESS,e,t,n)})})(e,Math.min(n.loaded/n.total*100,100)/e.length,n.loaded/e.length,r),r(h.BATCH_PROGRESS,t)};var z=()=>{const{trigger:e,target:t}=Object(r.default)({send:(t,n,r)=>{const a=r.destination,s=null==a?void 0:a.url,i=Object(o.throttle)(r=>Q(t,n,r,e),50,!0);return(Object(o.isFunction)(r.send)?r.send:k.default)(t,s,{method:(null==a?void 0:a.method)||r.method||X.method,paramName:(null==a?void 0:a.filesParamName)||r.inputFieldName||"file",params:{...r.params,...null==a?void 0:a.params},forceJsonResponse:r.forceJsonResponse,withCredentials:r.withCredentials,formatGroupParamName:r.formatGroupParamName,headers:null==a?void 0:a.headers,sendWithFormData:r.sendWithFormData,formatServerResponse:r.formatServerResponse},i)}},Object.values(h));return t};const J=Object(o.hasWindow)()&&"FileList"in window,W=(e,t=0)=>{let n=e;return Object(o.isProduction)()||(t<3&&i(e)?n=g(e):t<3&&c(e)&&(n=Array.isArray(e)?Object.keys(e).map(t=>W(e[t])):Object.keys(e).reduce((n,r)=>(n[r]=W(e[r],t+1),n),{}))),n};let Z=0;var V=(e,t,n)=>{Z+=1;const r="batch-"+Z,a=(e=>J&&e instanceof FileList||"[object FileList]"===e.toString())(e);e=Array.isArray(e)||a?e:[e];const s=!n.autoUpload,i=((e,t,n,r)=>Array.prototype.filter.call(t,r||$).map(t=>Object(o.createBatchItem)(t,e,n)))(r,e,s,n.fileFilter);return{id:r,uploaderId:t,items:i,state:s?o.BATCH_STATES.PENDING:o.BATCH_STATES.ADDED,completed:0,loaded:0,orgItemCount:i.length}};const Y=Object.values(f);let K=0;var ee=e=>{K+=1;const t="uploader-"+K;let n=!1;const a={};o.logger.debugLog(`uploady.uploader: creating new instance (${t})`,{options:e,counter:K});let s=(e=>{return{...X,...e,destination:e&&e.destination?(t=e.destination,{params:{},...t}):null};var t})(e);const i=()=>{p.clearPendingBatches()};let{trigger:c,target:d}=Object(r.default)({id:t,update:e=>(s=Object(o.merge)({},s,e),d),add:(e,t)=>{const n=Object(o.merge)({},s,t);n.clearPendingOnAdd&&i();const r=p.addNewBatch(e,d.id,n);let a;return r.items.length?a=p.runCancellable(f.BATCH_ADD,r,n).then(e=>{e?(r.state=o.BATCH_STATES.CANCELLED,l(f.BATCH_CANCEL,r)):(o.logger.debugLog(`uploady.uploader [${d.id}]: new items added - auto upload =\n                        ${String(n.autoUpload)}`,r.items),n.autoUpload&&p.process(r))}):o.logger.debugLog(`uploady.uploader: no items to add. batch ${r.id} is empty. check fileFilter if this isn't intended`),a||Promise.resolve()},upload:e=>{p.processPendingBatches(e)},abort:e=>{p.abort(e)},abortBatch:e=>{p.abortBatch(e)},getOptions:()=>Object(o.clone)(s),clearPending:i,registerExtension:(e,t)=>{Object(o.invariant)(n,"Uploady - uploader extensions can only be registered by enhancers"),Object(o.invariant)(!a[e],"Uploady - uploader extension by this name [%s] already exists",e),o.logger.debugLog("uploady.uploader: registering extension: "+e.toString(),t),a[e]=t},getExtension:e=>a[e]},Y,{canAddEvents:!1,canRemoveEvents:!1});const l=(e,...t)=>{const n=Object(r.createLifePack)(()=>t.map(W));return c(e,n)},u=Object(o.triggerCancellable)(l);if(s.enhancer){n=!0;const e=s.enhancer(d,l);n=!1,d=e||d}const p=((e,t,n,r)=>{const o=z(),a=q(n,e,t,o,r);return{process:(e,t)=>{a.uploadBatch(e,t)},abortBatch:e=>{a.abortBatch(e)},abort:e=>{e?a.abortItem(e):a.abortAll()},addNewBatch:(e,t,n)=>{const r=V(e,t,n);return a.addBatch(r,n)},runCancellable:a.runCancellable,clearPendingBatches:()=>{a.clearPendingBatches()},processPendingBatches:e=>{a.uploadPendingBatches(e)}}})(l,u,s,d.id);return Object(o.devFreeze)(d)},te=(...e)=>(t,...n)=>e.reduce((e,t)=>t(e,...n)||e,t);t.default=ee},Xsbf:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return A})),n.d(t,"addLife",(function(){return A})),n.d(t,"isLE",(function(){return u})),n.d(t,"createLifePack",(function(){return O}));var r=n("JlUD"),o=n.n(r),a=n("mHo/");var s=Object(a.devFreeze)({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1});const i=Symbol.for("__le__"),c=Symbol.for("__le__pack__"),d=e=>e?e[i]:null,l=e=>{const t=d(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},u=e=>!!d(e),p=(e,t,n,r=!1)=>{((e,t)=>{if(!Object(a.isFunction)(e))throw new Error(`'${t}' is not a valid function`)})(n,"cb");const o=l(e);if(!o.options.allowRegisterNonExistent&&!~o.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);const s=o.registry[t]||[];return s.find(e=>e.cb===n)||(s.push({name:t,cb:n,once:r}),o.registry[t]=s),()=>m.call(e,t,n)},g=(e,t)=>{const n=l(e).registry;return t?n[t]?n[t].slice():[]:Object.values(n).flat()},f={on:function(e,t){return p(this,e,t)},once:function(e,t){return p(this,e,t,!0)},off:m,getEvents:function(){return l(this).events.slice()}},h={trigger:function(e,...t){const n=g(this,e);let r;if(n.length){var a;let s;1===t.length&&!0===(null===(a=t[0])||void 0===a?void 0:a[c])&&(s=t[0].resolve()),r=n.map(n=>{let r;return n.once&&S(this,e,n.cb),r=s?n.cb(...s):t.length?1===t.length?n.cb(t[0]):2===t.length?n.cb(t[0],t[1]):3===t.length?n.cb(t[0],t[1],t[2]):n.cb(...t):n.cb(),r}).filter(e=>!(void 0===e)).map(e=>o()(e)?e:Promise.resolve(e))}return r&&(r.length?r:void 0)},addEvent:function(e){const t=l(this);if(!t.options.canAddEvents)throw new Error("Cannot add new events (canAddEvents = false)");if(~t.events.indexOf(e))throw new Error(`Event '${e}' already defined`);t.events.push(e)},removeEvent:function(e){const t=l(this);if(!t.options.canRemoveEvents)throw new Error("Cannot remove events (canRemoveEvents = false)");{const n=t.events.indexOf(e);t.events.splice(n,1)}},hasEvent:function(e){return!!~l(this).events.indexOf(e)},hasEventRegistrations:function(e){return!!g(this,e).length},assign:function(e){const t=l(this);return T(e,t.options,t.events,t.registry,t.stats),E(e)}},E=e=>Object.keys(h).reduce((t,n)=>(t[n]=h[n].bind(e),t),{target:e,...h}),b=(e,t,n=!1)=>{const r=l(e).registry;!r[t]||!n&&r[t].length||delete r[t]},S=(e,t,n)=>{const r=l(e).registry;r[t]&&(n?(r[t]=r[t].filter(e=>e.cb!==n),b(e,t)):b(e,t,!0))};function m(e,t){S(this,e,t)}const T=(e,t,n=[],r={},o={})=>{Object.defineProperties(e,{[i]:{value:Object.seal({registry:r,events:n,options:t,stats:o})},...Object.entries(f).reduce((e,[t,n])=>(e[t]={value:n},e),{})})};var A=(e,t=[],n)=>(e=e||{},n={...s,...n},u(e)||T(e,n,t),E(e));var O=e=>{const t={resolve:()=>[].concat(e())};return Object.defineProperty(t,c,{value:!0,configurable:!1}),t}},"mHo/":function(e,t,n){"use strict";n.r(t),n.d(t,"BATCH_STATES",(function(){return c})),n.d(t,"FILE_STATES",(function(){return d})),n.d(t,"invariant",(function(){return a.a})),n.d(t,"throttle",(function(){return i.a})),n.d(t,"logger",(function(){return r})),n.d(t,"triggerCancellable",(function(){return h})),n.d(t,"triggerUpdater",(function(){return b})),n.d(t,"createBatchItem",(function(){return T})),n.d(t,"request",(function(){return O})),n.d(t,"parseResponseHeaders",(function(){return A})),n.d(t,"isFunction",(function(){return y.a})),n.d(t,"isPlainObject",(function(){return C})),n.d(t,"isSamePropInArrays",(function(){return _})),n.d(t,"devFreeze",(function(){return P})),n.d(t,"merge",(function(){return w})),n.d(t,"getMerge",(function(){return D})),n.d(t,"clone",(function(){return j})),n.d(t,"pick",(function(){return B})),n.d(t,"hasWindow",(function(){return l})),n.d(t,"isProduction",(function(){return R.a}));var r={};n.r(r),n.d(r,"isDebugOn",(function(){return p})),n.d(r,"setDebug",(function(){return g})),n.d(r,"debugLog",(function(){return f}));var o=n("kvau"),a=n.n(o),s=n("uDTZ"),i=n.n(s);const c={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted"},d={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"};var l=()=>"object"==typeof window&&!!window.document;let u;const p=()=>("boolean"!=typeof u&&(u=l()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||!0===window["__rpldy-logger-debug__"])),!!u),g=e=>{l()&&(window["__rpldy-logger-debug__"]=e),u=!!e||null},f=(...e)=>{p()&&console.log(...e)};var h=(e,t,...n)=>{const r=(t,...n)=>new Promise((r,o)=>{const a=e(t,...n);a&&a.length?Promise.all(a).catch(o).then(e=>e&&r(!!~e.findIndex(e=>!1===e))):r(!1)});return t?r(t,...n):r};const E=e=>null==e;var b=(e,t,...n)=>{const r=(t,...n)=>new Promise((r,o)=>{const a=e(t,...n);a&&a.length?Promise.all(a).catch(o).then(e=>{let t;if(e)for(;E(t)&&e.length;)t=e.pop();r(E(t)?void 0:t)}):r()});return t?r(t,...n):r};const S=Symbol.for("__rpldy-bi__");let m=0;var T=(e,t,n=!1)=>{m+=e.id&&e.batchId?0:1;let r={id:e.id&&e.batchId?e.id:`${t}.item-${m}`,batchId:t,state:n?d.PENDING:d.ADDED,uploadStatus:0,completed:0,loaded:0,aborted:!1,recycled:!1,previousBatch:null};if(Object.defineProperty(r,S,{value:!0,writable:!0}),"object"==typeof e&&!0===e[S]&&(r.recycled=!0,r.previousBatch=e.batchId,e=e.file||e.url),"string"==typeof e)r=((e,t)=>(e.url=t,e))(r,e);else{if(!(e=>e&&(e instanceof Blob||e instanceof File||"object"==typeof e&&e.name&&e.type))(e))throw new Error("Unknown type of file added: "+typeof e);r=((e,t)=>(e.file=t,e))(r,e)}return r};var A=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((e,t)=>{const[n,r]=t.split(": ");return e[n]=r,e},{})}catch(t){f("uploady.request: failed to read response headers",e)}return t},O=(e,t,n={})=>{const r=new XMLHttpRequest,o=new Promise((o,a)=>{r.onerror=()=>a(r),r.ontimeout=()=>a(r),r.onabort=()=>a(r),r.onload=()=>o(r),r.open(n.method||"GET",e),((e,t)=>{t&&Object.keys(t).forEach(n=>{void 0!==t[n]&&e.setRequestHeader(n,t[n])})})(r,n.headers),r.withCredentials=!!n.withCredentials,n.preSend&&n.preSend(r),r.send(t)});return o.xhr=r,o},v=n("r5yn"),y=n.n(v);var _=(e,t,n)=>{let r=!0;const o=(e=>{const t=[].concat(e);return e=>e.map(e=>t.map(t=>e[t]).join())})(n);if(e&&t&&e.length===t.length){const n=o(e),a=o(t);r=!!n.find((e,t)=>e!==a[t])}return!r},I=n("DVTP"),R=n.n(I);var P=e=>R()()?e:Object.freeze(e),C=e=>{var t;return!!e&&"object"==typeof e&&("Object"===(null===(t=Object.getPrototypeOf(e))||void 0===t?void 0:t.constructor.name)||null===Object.getPrototypeOf(e))};const L=e=>C(e)||Array.isArray(e),D=(e={})=>{const t=(n,...r)=>(n&&r.length&&r.forEach(r=>{r&&((e,t)=>{const n=Object.keys(e);return t.withSymbols?n.concat(Object.getOwnPropertySymbols(e)):n})(r,e).forEach(o=>{const a=r[o];e.predicate&&!e.predicate(o,a)||(void 0!==a||e.undefinedOverwrites)&&(L(a)?(void 0!==n[o]&&C(n[o])||(n[o]=Array.isArray(a)?[]:{}),t(n[o],a)):n[o]=a)})}),n);return t};var w=D(),j=(e,t=w)=>L(e)?t(Array.isArray(e)?[]:{},e):e,B=(e,t)=>e&&Object.keys(e).reduce((n,r)=>(~t.indexOf(r)&&(n[r]=e[r]),n),{})},r5yn:function(e,t){e.exports=function(e){return"function"==typeof e}}})}));
//# sourceMappingURL=rpldy-core.umd.min.js.map